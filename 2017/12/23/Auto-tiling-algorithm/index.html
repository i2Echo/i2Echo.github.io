<!DOCTYPE html><html lang="en"><head><title>关于地图编辑器自动拼接算法的深入浅出 | Kujohn&#39;s blog</title><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://www.google-analytics.com"><meta http-equiv="X-UA-Compatible"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#0097A7"><meta name="author" content="Kujohn"><meta name="description" content="Life is like a box of chocolates and you never know what you gonna get."><meta name="keywords" content="blog, javascript, EF,auto-tiling,地图编辑器,RPG,算法"><link rel="icon shortcut" type="image/ico" href="/favicon.ico"><link rel="icon" sizes="192x192" href="/favicon.ico"><link rel="apple-touch-icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-title" content="Title"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="480"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Kujohn&#39;s blog"><meta property="og:url" content="https://kujohnln.com"><meta property="og:type" content="blog"><meta property="og:title" content="关于地图编辑器自动拼接算法的深入浅出 | Kujohn&#39;s blog"><meta property="og:description" content="Life is like a box of chocolates and you never know what you gonna get."><meta property="og:article:tag" content="auto-tiling"><meta property="og:article:tag" content="地图编辑器"><meta property="og:article:tag" content="RPG"><meta property="og:article:tag" content="算法"><!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]--><link rel="stylesheet" href="/css/material.css"><link rel="stylesheet" href="/css/style.css"><style>body,html{font-family:Roboto,"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif}a{color:#00838F}#scheme-Paradox .hot_tags-count,#scheme-Paradox .sidebar-colored .sidebar-badge,#scheme-Paradox .sidebar-colored .sidebar-header,#scheme-Paradox .sidebar_archives-count,#search-form-label:after,#search-label,.mdl-card__media{background-color:#0097A7!important}#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus,#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover{color:#0097A7!important}#ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a,#post_entry-right-info,.sidebar-colored .sidebar-nav li:hover>a,.sidebar-colored .sidebar-nav li:hover>a i,.sidebar-colored .sidebar-nav li>a:focus i,.sidebar-colored .sidebar-nav li>a:hover,.sidebar-colored .sidebar-nav li>a:hover i,.sidebar-colored .sidebar-nav>.open>a,.sidebar-colored .sidebar-nav>.open>a:focus,.sidebar-colored .sidebar-nav>.open>a:hover{color:#0097A7!important}.toTop{background:#009688!important}.material-layout .material-index>.material-nav,.material-layout .material-post>.material-nav,.material-nav a{color:#009688}#scheme-Paradox .MD-burger-layer{background-color:#009688}#scheme-Paradox #post-toc-trigger-btn{color:#009688}.post-toc a:hover{color:#00838F;text-decoration:underline}</style><style>body{background-color:#F5F5F5}#scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{background-color:#fff}</style><style>.fade{transition:all .8s linear;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);-o-transform:translate3d(0,0,0);transform:translate3d(0,0,0);opacity:1}.fade.out{opacity:0}</style><script src="/js/jquery.min.js"></script><script src="/js/queue.js"></script><script>var agent=navigator.userAgent.toLowerCase();agent.indexOf("ucbrowser")>0&&(document.write('<link rel="stylesheet" href="/css/uc.css">'),alert("由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。"))</script><script>!function(e,t,a,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=t.createElement(a),o=t.getElementsByTagName(a)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-102920741-1","auto"),ga("send","pageview")</script><link rel="stylesheet" href="/css/prism.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body id="scheme-Paradox" class="lazy"><div class="material-layout mdl-js-layout has-drawer is-upgraded"><main class="material-layout__content" id="main"><div id="top"></div><button class="MD-burger-icon sidebar-toggle"><span class="MD-burger-layer"></span></button> <button id="post-toc-trigger-btn" class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">format_list_numbered</i></button><ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh;overflow-y:scroll"><ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言:</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分析问题"><span class="post-toc-number">2.</span> <span class="post-toc-text">分析问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#图源分析对比"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">图源分析对比</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分析结果"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">分析结果</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#解决问题"><span class="post-toc-number">3.</span> <span class="post-toc-text">解决问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现思路"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">实现思路</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#修正"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">修正</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#效果"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">效果</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#最后"><span class="post-toc-number">4.</span> <span class="post-toc-text">最后</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考文献"><span class="post-toc-number">5.</span> <span class="post-toc-text">参考文献</span></a></li></ol></ul><div class="material-post_container"><div class="material-post mdl-grid"><div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50"><script>var randomNum=Math.floor(19*Math.random()+1);$(".post_thumbnail-random").attr("data-original","/img/random/material-"+randomNum+".png"),$(".post_thumbnail-random").addClass("lazy")</script><p class="article-headline-p">关于地图编辑器自动拼接算法的深入浅出</p></div><div class="mdl-color-text--grey-700 mdl-card__supporting-text meta"><div id="author-avatar"><img src="/images/logo.jpg" width="44px" height="44px" alt="Author Avatar"></div><div><strong>Kujohn</strong> <span>Dec 23, 2017</span></div><div class="section-spacer"></div><button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">devices other</i> <span class="visuallyhidden">devices other</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button"><li class="mdl-menu__item">Read this article on other device</li><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC1klEQVR42u3aUXLiQAwEUO5/6d0DUJBu2ewSzfNXipjxPKiKotY8/hx5PbCxsbGxsbGxsbG/kv2Ir5fLPf32ynufV3i+c7ZnbGxs7N3sH/70v4Al97+HzRjDPWNjY2MfwE4ekxSVV6+8L1R3FTNsbGxs7Jw9K1ftOsmd2NjY2NgtOwpxRiXn3tWwsbGxT2PnIVHyyvuGJGlUZpEWNjY29pnsWTT/f3/+p/NtbGxs7C9mt1c+BpiVsSul7oedY2NjYy9lzwKj5F//9nBP+676kCg2Njb2UnYSzbfx/ZVR7mz9aNiMjY2NvZSdNwPtmPb6BzRrQuosDRsbG/uXs2fFINligpm9a9bkYGNjY29lJ5vIo592ZDv7KIeFExsbG3spu41y8rB+FiRdGQnX821sbGzsFez2wE0L+8RH0BY5bGxs7N3s/CDOI7jy4zjtYZ1kRIGNjY2NXUTto8AoHw8kpDoCw8bGxl7KnpWlu47d5MFQ+0RsbGzsc9jtQjNAvnISReX3YGNjY5/DboemeaFqm5M2SCqOE2FjY2OvZn8i+smbhKIIlTvBxsbGPofdDm4/EehfL4Q/fJ3Y2NjYq9ltZJOXwLak3ftxY2NjY5/GzpF5azErYHm0VBz6xMbGxj6AfUMEf7mFaA/6FCUNGxsbeyl79oDZOLa9M2lmioE0NjY29mp2Hv3kD7vrEE/7xRQFDBsbG3spOx8S5OWqbTby6KpocrCxsbEPZufHItvoJ9lJsreodcHGxsZeyr6hMLSPL4fHeTksQiVsbGzsRey2MLTj2NnAOCmBtw16sbGxsVew86J1ZTQ7e31W9opBLzY2NvYidj4YaDfXBljtFTUt2NjY2Njtv/7lmDY/PNS2KNjY2NjYeZG40t7M7smjLmxsbOwT2LPhbjKmzdfJR8htRIWNjY29mz0Lbu46mtkOj9sCjI2Njb2bfc6FjY2NjY2NjY2N/TXXX4v9zuGSQolAAAAAAElFTkSuQmCC"></ul><button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">bookmark</i> <span class="visuallyhidden">bookmark</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button"><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/RPG/">RPG</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/auto-tiling/">auto-tiling</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/地图编辑器/">地图编辑器</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/算法/">算法</a></li></ul><button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">share</i> <span class="visuallyhidden">share</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button"><a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=关于地图编辑器自动拼接算法的深入浅出&url=https://kujohnln.com//2017/12/23/Auto-tiling-algorithm/index.html&pic=&searchPic=false&style=simple" target="_blank"><li class="mdl-menu__item">Share to Weibo</li></a><a class="post_share-link" href="https://twitter.com/intent/tweet?text=关于地图编辑器自动拼接算法的深入浅出&url=https://kujohnln.com//2017/12/23/Auto-tiling-algorithm/index.html&via=Kujohn" target="_blank"><li class="mdl-menu__item">Share to Twitter</li></a><a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://kujohnln.com//2017/12/23/Auto-tiling-algorithm/index.html" target="_blank"><li class="mdl-menu__item">Share to Facebook</li></a><a class="post_share-link" href="https://plus.google.com/share?url=https://kujohnln.com//2017/12/23/Auto-tiling-algorithm/index.html" target="_blank"><li class="mdl-menu__item">Share to Google+</li></a><a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Kujohn&#39;s blog&title=关于地图编辑器自动拼接算法的深入浅出&summary=Life is like a box of chocolates and you never know what you gonna get.&pics=https://kujohnln.com/favicon.ico&url=https://kujohnln.com/2017/12/23/Auto-tiling-algorithm/index.html" target="_blank"><li class="mdl-menu__item">Share to QQ</li></a></ul></div><div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out"><h2 id="前言"><a href="#前言" class="headerlink" title="前言:"></a>前言:</h2><p>接触过RMXP的想必都知道有一个叫autotile的东西吧，或许你也跟我一样会觉得RPG地图编辑器里面的这种自动拼接的tile真的很神奇（不同状态下tile的表现形式是不一样的）；之前传统的瓦片式地图之间没有过渡效果，看起来比较粗糙，但是有了种autotile的出现，方块式的游戏地图也能不那么单调了，刚好最近需要使用这种autotile的功能，搜索了下却没找到什么比较详细的资料，经过一番探究以及一个小伙伴的启发，总算实现了这个autotile的效果。<br><a id="more"></a></p><h2 id="分析问题"><a href="#分析问题" class="headerlink" title="分析问题"></a>分析问题</h2><p>用RMXP画几下就知道，一个autotile周围出现不同数量，或者位置关系不同的同种autotile时，每一块tile的表现形式是会变化的；一开始我看了许久，也没找出什么规律或者说一时没办法想到怎么取描述这些变化并用程序表现出来，然后我试着将素材划分成32*32的块，对比变化，看起来好多了，都知道哪里变化了，然后试着用canvas画了下，然而感觉好麻烦，半天没弄出来，有点气馁；然后就先丢一边不管了~~，后面看到一个小伙伴的解法（今天我要讲的解法与他的差别蛮大，主要思路是不同的），我才恍然大悟。</p><h3 id="图源分析对比"><a href="#图源分析对比" class="headerlink" title="图源分析对比"></a>图源分析对比</h3><p>一般autotile素材是提供了一张96*128素材嘛，我用Photoshop将他划分成48块16*16的小块，<br><img src="/images/upload/splitAutotile.png" alt="划分autotile"><br>然后对比变化，发现变化的地方都发生在每块tile相邻的16*16的块中，因为本来autotile就是依据与他相邻位置autotile的情况而变化的，也就是说只有相邻的接壤处会发生变化，示意图如下，我把将要放置的块用红色表示，与红色块相邻的位置块为蓝色，与红色块接壤处的块标记为黄色（只是用来表示下位置关系，与该素材无关）：<br><img src="/images/upload/showPosition.png" alt="位置关系示意图"><br>经对比可发现每次变化的地方必出现在黄色块区域，所以只需要分析黄色区域的变化情况有多少种就可以了，受到小伙伴的启发（它是将autotile块的拼接情况分好，就是比如四个方向都不需要与其他autotile拼接这块的四个方向就设为0，某一方向需要与其他块拼接就置为1，这样预置画图[32*32]，遍历整个地图再将预置图画上去,那种方法很好，但是我并不满意这种处理方法），然后我可以将需要变化的地方置为1，不需要变化的置为0（以该示例图来说，你会发现是草的地方不会变化，水的地方是变化的）。</p><h3 id="分析结果"><a href="#分析结果" class="headerlink" title="分析结果"></a>分析结果</h3><p>得到以上分析之后，我们来分析每个黄色块（即接壤处的块）的变化情况，前面已经说了，每个变化的最小单位是16*16的小图片中，那么将黄色块分成4个16*16的小块，那么所有变化情况很显然为2^4种（即16种），这时候我们将变化的小块置为1，不变化的小块置为0，则可得到16种情况；然后依次将16种情况套到被分割成48小块的原素材中，如果以索引数组表示这16种情况我们可得到以下结果：</p><pre class="line-numbers language-js"><code class="language-js">  <span class="token comment" spellcheck="true">// 0代表不变化的小块，1代表变化的小块（或者这里直观地说，草代表0，水代表1）</span>
  <span class="token comment" spellcheck="true">// 0 | 0</span>
  <span class="token comment" spellcheck="true">//---+--- //0000  [10, 9, 4, 3]</span>
  <span class="token comment" spellcheck="true">// 0 | 0</span>

  <span class="token comment" spellcheck="true">// 0 | 0</span>
  <span class="token comment" spellcheck="true">//---+--- //0001  [10, 9, 4, 13]</span>
  <span class="token comment" spellcheck="true">// 0 | 1</span>
  <span class="token comment" spellcheck="true">//依次类推。。。得到总共16种情况</span>
<span class="token keyword">var</span> indexArrs <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token comment" spellcheck="true">//16种组合的图块索引数组; // 将autotile分割成48块16*16的小块; 数组索引即对应各个小块</span>
  <span class="token comment" spellcheck="true">//                                       +----+----+----+----+----+----+</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//0   bin:0000      | 1  | 2  | 3  | 4  | 5  | 6  |</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//1   bin:0001      +----+----+----+----+----+----+</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//2   bin:0010      | 7  | 8  | 9  | 10 | 11 | 12 |</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//3   bin:0011      +----+----+----+----+----+----+</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//4   bin:0100      | 13 | 14 | 15 | 16 | 17 | 18 |</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//5   bin:0101      +----+----+----+----+----+----+</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//6   bin:0110      | 19 | 20 | 21 | 22 | 23 | 24 |</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//7   bin:0111      +----+----+----+----+----+----+</span>
    <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//8   bin:1000      | 25 | 26 | 27 | 28 | 29 | 30 |</span>
    <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//9   bin:1001      +----+----+----+----+----+----+</span>
    <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//10  bin:1010      | 31 | 32 | 33 | 34 | 35 | 36 |</span>
    <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//11  bin:1011      +----+----+----+----+----+----+</span>
    <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//12  bin:1100      | 37 | 38 | 39 | 40 | 41 | 42 |</span>
    <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//13  bin:1101      +----+----+----+----+----+----+</span>
    <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">//14  bin:1110      | 43 | 44 | 45 | 46 | 47 | 48 |</span>
    <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span>   <span class="token comment" spellcheck="true">//15  bin:1111      +----+----+----+----+----+----+</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后对应16种变化区域组合的图块如下：<br><img src="/images/upload/blocks.png" alt="组合块"></p><h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>好了，有了以上基础，就可以用程序实现下这个autotile的画图了，这里使用html5的canvas实现。<br>大致步骤如下：</p><ul><li>遍历一个地图数组，如果该位置为autotile，则进行位置关系分析</li><li>位置关系的分析主要过程是，遍历周围8个块（32*32）如果是一致的autotile材料则置该位置id为1，不是则置为0，然后将这个1或0分配到四个格子里（当然，当前块是autotile分配到四个块里也都是1）示意图如下：</li><li>然后取由四个小块组成黄色框的块的四个值依次从上到下从左到右顺序组成四位二进制数（0~15），然后们依据这四位二进制数即可找到前面对应的数组的索引。</li><li>因为我们是需要遍历整个地图，所以只需要画当前块就行了，到这里其实我们已经找到当前块的四个小块对应原素材的图片索引了（也就是红色区域分别取4个黄色区域的四个角，四个黄色的数组前面已经找到了，所以分别取这四个位置的对应数组的值就行了）</li><li>最后得到所有autotile对应的数组索引就可以画图了</li></ul><p>其实这里你可能会说碰到边界怎么办，其实这里不需要考虑边界，因为画的时候只画当前块，周围只是用来判断关系的，你大可将边界视为一般普通的块，最后画图并不会到边界外所以不会报错。<br><img src="/images/upload/binImg.png" alt="二进制关系示意图"></p><h3 id="修正"><a href="#修正" class="headerlink" title="修正"></a>修正</h3><p>经过以上过程，我写了一个demo，并用它画了不同素材的autotile之后，发现四个外角与边其实有点不搭（可能因为边角是固定搭配吧，但是这种解法是体现不出一个边角的固定搭配的，因为都是反应块与块之间的接壤关系，而不管块内部的搭配关系），所以我觉得应该修正一下，我用一张数字的素材进行了修正，非常推荐，很好用，如图：<br><img src="/images/upload/autotile15.png" alt="数字索引autotile"><br>我最终的修正关系是：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">//修正四个边角的固定搭配</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//左上外角为13，邻边小块为16和31时需要修正,下面类似</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">)</span> blockIndexs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">31</span><span class="token punctuation">)</span> blockIndexs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">15</span><span class="token punctuation">)</span> blockIndexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">36</span><span class="token punctuation">)</span> blockIndexs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">25</span><span class="token punctuation">)</span> blockIndexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">37</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">46</span><span class="token punctuation">)</span> blockIndexs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">)</span> blockIndexs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>blockIndexs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">45</span><span class="token punctuation">)</span> blockIndexs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">47</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还有一个修正的地方就是边界之外应该也视为autotile并且是通用autotile，那样画图看起来好看多了。</p><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p>反正最后效果还是不错的，不多说，直接上图：<br><img src="/images/upload/result-at.png" alt="效果图"></p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>到此，就是关于本次autotile算法的一个分享了，如果还有疑问，这里给出我<a href="https://github.com/i2Echo/autotileDemo" target="_blank" rel="noopener">github的源码</a>，以及效果展示<a href="http://ghpages.kujohnln.com/autotileDemo/" target="_blank" rel="noopener">demo</a>，感兴趣的你可以参考一下~~</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ul><li><a href="http://blog.csdn.net/blizmax6/article/details/6736783" target="_blank" rel="noopener">魔兽争霸3- Terrain , 自动拼接地形渲染方式</a></li><li><a href="http://blog.csdn.net/gouki04/article/details/7107088" target="_blank" rel="noopener">浅谈RPG Maker XP自动地图元件的绘制原理</a></li></ul></div><div id="disqus-comment"><div id="disqus_thread"></div><style>.ripple-container .ripple{background-color:rgba(255,255,255,.4);animation:ripple 2s forwards cubic-bezier(0,0,.2,1)}@keyframes ripple{0%{transform:scale(0);opacity:1}80%{transform:scale(1)}100%{opacity:0}}.disqus_click_btn{line-height:30px;margin:0;min-width:50px;padding:0 14px;display:inline-block;font-family:Roboto,Helvetica,Arial,sans-serif;font-size:14px;font-weight:400;text-transform:uppercase;letter-spacing:0;overflow:hidden;will-change:box-shadow;transition:box-shadow .2s cubic-bezier(.4,0,1,1),background-color .2s cubic-bezier(.4,0,.2,1),color .2s cubic-bezier(.4,0,.2,1);outline:0;cursor:pointer;text-decoration:none;text-align:center;vertical-align:middle;border:0;background:rgba(158,158,158,.2);box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);color:#fff;background-color:#009688;text-shadow:0}</style><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 DISQUS 可以正常加载）</button></div><script>Array.prototype.forEach.call(document.querySelectorAll("[data-ripple]"),function(e){new RippleEffect(e)})</script><script>var disqus_config=function(){this.page.url="https://kujohnln.com/2017/12/23/Auto-tiling-algorithm/",this.page.identifier="https://kujohnln.com/2017/12/23/Auto-tiling-algorithm/"};$(".btn_click_load").click(function(){!function(){var t=document,i=t.createElement("script");i.src="//ikuyman-pub.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(i)}(),$(".btn_click_load").css("display","none")})</script></div><style>#disqus-comment{background-color:#eee;padding:2pc}</style></div><nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col"><div class="section-spacer"></div><a href="/2017/11/18/Run-node-server-on-linux/" id="post_nav-older" class="next-content">Older &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation"><i class="material-icons">arrow_forward</i></button></a></nav></div></div><div class="sidebar-overlay"></div><aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation"><div id="sidebar-main"><div class="sidebar-header header-cover" style="background-image:url(/img/sidebar_header.png)"><div class="top-bar"></div><button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display:initial" data-upgraded=",MaterialButton,MaterialRipple"><i class="material-icons">clear_all</i> <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button><div class="sidebar-image"><img src="/images/logo.jpg" alt="Kujohn's avatar"></div><a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">Kujohn&#39;s blog <b class="caret"></b></a></div><ul class="nav sidebar-nav"><li class="dropdown"><ul id="settings-dropdown" class="dropdown-menu"><li><a href="mailto:sama2echo@gmail.com" target="_blank" title="Email Me"><i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i> Email Me</a></li></ul></li><li id="sidebar-first-li"><a href="/" target="_self"><i class="material-icons sidebar-material-icons">home</i> Home</a></li><li class="dropdown"><a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown"><i class="material-icons sidebar-material-icons">inbox</i> Archives <b class="caret"></b></a><ul class="dropdown-menu"><li><a class="sidebar_archives-link" href="/archives/2017/12/">December 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">November 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">September 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">July 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">March 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">June 2015<span class="sidebar_archives-count">6</span></a></li></ul></li><li class="dropdown"><a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown"><i class="material-icons sidebar-material-icons">chrome_reader_mode</i> Categories <b class="caret"></b></a><ul class="dropdown-menu"><li><a class="sidebar_archives-link" href="/categories/CSS/">CSS<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/Excel/">Excel<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Hexo/">Hexo<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Javascript/">Javascript<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Linux/">Linux<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/Music/">Music<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Python/">Python<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/Regx/">Regx<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Sass/">Sass<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Tools/">Tools<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/算法/">算法<span class="sidebar_archives-count">3</span></a></li></ul></li><li><a href="/about" title="About"><i class="material-icons sidebar-material-icons">person</i> About</a></li><li class="divider"></li><li><a href="/archives">Articles <span class="sidebar-badge">23</span></a></li></ul></div></aside><div id="back-to-top" class="toTop-wrap"><a href="#top" class="toTop"><i class="material-icons footer_top-i">expand_less</i></a></div><footer class="mdl-mini-footer" id="bottom"><div class="mdl-mini-footer--left-section sns-list"><a href="https://twitter.com/KujohnLn" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image:url(/img/footer/footer_ico-twitter.svg)"><span class="visuallyhidden">Twitter</span></button></a><a href="https://weibo.com/kuJohn" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image:url(/img/footer/footer_ico-weibo.svg)"><span class="visuallyhidden">Weibo</span></button></a><a href="https://github.com/i2Echo" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image:url(/img/footer/footer_ico-github.svg)"><span class="visuallyhidden">Github</span></button></a></div><div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd=new Date;document.write(fd.getFullYear())</script>&nbsp;Kujohn's blog</div><div class="mdl-mini-footer--right-section"><div><div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div><div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div></div></div></footer><script src="/js/lazyload.min.js"></script><script src="/js/js.js"></script><script src="/js/canvas-nest.min.js"></script><script src="/js/nprogress.js"></script><script type="text/javascript">NProgress.configure({showSpinner:!0}),NProgress.start(),$("#nprogress .bar").css({background:"#29d"}),$("#nprogress .peg").css({"box-shadow":"0 0 10px #29d, 0 0 15px #29d"}),$("#nprogress .spinner-icon").css({"border-top-color":"#29d","border-left-color":"#29d"}),setTimeout(function(){NProgress.done(),$(".fade").removeClass("out")},800)</script><script>$(window).load(function(){$(".post-toc-wrap").parent(".mdl-menu__container").css("position","fixed")})</script><script>queue.offer(function(){$(".lazy").lazyload({effect:"show"})}),$(document).ready(function(){setTimeout(function(){setInterval(function(){queue.execNext()},200)},3e3)})</script></main></div></body></html>