<!DOCTYPE html><html lang="en"><head><title>全宋词之东风何处是人间 | Kujohn&#39;s blog</title><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://www.google-analytics.com"><meta http-equiv="X-UA-Compatible"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#0097A7"><meta name="author" content="Kujohn"><meta name="description" content="Life is like a box of chocolates and you never know what you gonna get."><meta name="keywords" content="blog, javascript, EF,python,scrapy"><link rel="icon shortcut" type="image/ico" href="/favicon.ico"><link rel="icon" sizes="192x192" href="/favicon.ico"><link rel="apple-touch-icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-title" content="Title"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="480"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Kujohn&#39;s blog"><meta property="og:url" content="https://kujohnln.com"><meta property="og:type" content="blog"><meta property="og:title" content="全宋词之东风何处是人间 | Kujohn&#39;s blog"><meta property="og:description" content="Life is like a box of chocolates and you never know what you gonna get."><meta property="og:article:tag" content="python"><meta property="og:article:tag" content="scrapy"><!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]--><link rel="stylesheet" href="/css/material.css"><link rel="stylesheet" href="/css/style.css"><style>body,html{font-family:Roboto,"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif}a{color:#00838F}#scheme-Paradox .hot_tags-count,#scheme-Paradox .sidebar-colored .sidebar-badge,#scheme-Paradox .sidebar-colored .sidebar-header,#scheme-Paradox .sidebar_archives-count,#search-form-label:after,#search-label,.mdl-card__media{background-color:#0097A7!important}#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus,#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover{color:#0097A7!important}#ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a,#post_entry-right-info,.sidebar-colored .sidebar-nav li:hover>a,.sidebar-colored .sidebar-nav li:hover>a i,.sidebar-colored .sidebar-nav li>a:focus i,.sidebar-colored .sidebar-nav li>a:hover,.sidebar-colored .sidebar-nav li>a:hover i,.sidebar-colored .sidebar-nav>.open>a,.sidebar-colored .sidebar-nav>.open>a:focus,.sidebar-colored .sidebar-nav>.open>a:hover{color:#0097A7!important}.toTop{background:#009688!important}.material-layout .material-index>.material-nav,.material-layout .material-post>.material-nav,.material-nav a{color:#009688}#scheme-Paradox .MD-burger-layer{background-color:#009688}#scheme-Paradox #post-toc-trigger-btn{color:#009688}.post-toc a:hover{color:#00838F;text-decoration:underline}</style><style>body{background-color:#F5F5F5}#scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{background-color:#fff}</style><style>.fade{transition:all .8s linear;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);-o-transform:translate3d(0,0,0);transform:translate3d(0,0,0);opacity:1}.fade.out{opacity:0}</style><script src="/js/jquery.min.js"></script><script src="/js/queue.js"></script><script>var agent=navigator.userAgent.toLowerCase();agent.indexOf("ucbrowser")>0&&(document.write('<link rel="stylesheet" href="/css/uc.css">'),alert("由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。"))</script><script>!function(e,t,a,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=t.createElement(a),o=t.getElementsByTagName(a)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-102920741-1","auto"),ga("send","pageview")</script><link rel="stylesheet" href="/css/prism.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body id="scheme-Paradox" class="lazy"><div class="material-layout mdl-js-layout has-drawer is-upgraded"><main class="material-layout__content" id="main"><div id="top"></div><button class="MD-burger-icon sidebar-toggle"><span class="MD-burger-layer"></span></button> <button id="post-toc-trigger-btn" class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">format_list_numbered</i></button><ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh;overflow-y:scroll"><ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用爬虫获取全宋词"><span class="post-toc-number">1.</span> <span class="post-toc-text">使用爬虫获取全宋词</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用工具scrapy"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">使用工具scrapy</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分析网页结构"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">分析网页结构</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#开始编写代码"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">开始编写代码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#运行"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">运行</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据预处理"><span class="post-toc-number">2.</span> <span class="post-toc-text">数据预处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#读取json文件"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">读取json文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#词句初步处理"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">词句初步处理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#保存为txt文件"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">保存为txt文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#全部的代码"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">全部的代码</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分词与分析"><span class="post-toc-number">3.</span> <span class="post-toc-text">分词与分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分词"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">分词</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用sqlite数据库"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">使用sqlite数据库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#fenci-py全部的代码"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">fenci.py全部的代码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#输出排序结果"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">输出排序结果</span></a></li></ol></li></ol></ul><div class="material-post_container"><div class="material-post mdl-grid"><div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50"><script>var randomNum=Math.floor(19*Math.random()+1);$(".post_thumbnail-random").attr("data-original","/img/random/material-"+randomNum+".png"),$(".post_thumbnail-random").addClass("lazy")</script><p class="article-headline-p">全宋词之东风何处是人间</p></div><div class="mdl-color-text--grey-700 mdl-card__supporting-text meta"><div id="author-avatar"><img src="/images/logo.jpg" width="44px" height="44px" alt="Author Avatar"></div><div><strong>Kujohn</strong> <span>Jun 10, 2015</span></div><div class="section-spacer"></div><button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">devices other</i> <span class="visuallyhidden">devices other</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button"><li class="mdl-menu__item">Read this article on other device</li><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACaUlEQVR42u3aQZLCMAwEQP7/afYBFGYkxSZLdU5UNoCbg+Ud6fH86euBh4eHh4eHh4d3M94jvvLn333+6/3X15O14eHh4Z3kfdhql4tLlpgsPX/vh5Xg4eHhHeSti8F6o78KmXzvuqjg4eHh3Y2XHJdzanIcx8PDw/sNXhI6JK/zJ/Hw8PDuyUv+4a+WjXzRt8ha8PDw8GJetQF28vUX+nt4eHh4S15zsKkVHCTF4IK14eHh4W3m9eLa9eJ6kURvTKGcteDh4eFdxMuXnoSq1fv5SqI7eHh4eJt5SUOrN1o6GQhIflY8PDy8b/F67ahJs7/3g66LDR4eHt55XnKQrR55q8f0pAxEhQcPDw/vCK9aGK5qZeVjCsnzeHh4eCd5eZyab9a9GDcfVhil1Hh4eHgD3jy07bXQJq21D5+Ah4eHd4RXDR2S+3moMSlReHh4eOd5Pcxk8LTKq0YneHh4eLt5PUC+9edB7WUjrXh4eHgHefPWfi/k7f2g5cKAh4eHdymvutFXj8iTg3s1FMbDw8M7yauWhLxU5Ifj3h08PDy8k7x800/+2hu3SspMEuzi4eHhneFV35wcxJNtfUdggYeHh3eGV/3K6sBB3mDrNc+adQ8PDw9vwJs3vSYH9LwUFQ7ZeHh4eJt5k+24umXnIwLV4oGHh4d3nldtd+XvujbAjb4XDw8P7yBvvqA8fs2HtJLn8fDw8P4L7zm+quNZzZQaDw8P76u8aliQF4akCG0vDHh4eHibc868kCQBbu9gvTFrwcPDw9vWAHu3TecFZr3dV0cN8PDw8Hbzfu/Cw8PDw8PDw8O7wfUHjygHSmczxcQAAAAASUVORK5CYII="></ul><button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">bookmark</i> <span class="visuallyhidden">bookmark</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button"><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/python/">python</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/scrapy/">scrapy</a></li></ul><button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">share</i> <span class="visuallyhidden">share</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button"><a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=全宋词之东风何处是人间&url=https://kujohnln.com//2015/06/10/songci/index.html&pic=&searchPic=false&style=simple" target="_blank"><li class="mdl-menu__item">Share to Weibo</li></a><a class="post_share-link" href="https://twitter.com/intent/tweet?text=全宋词之东风何处是人间&url=https://kujohnln.com//2015/06/10/songci/index.html&via=Kujohn" target="_blank"><li class="mdl-menu__item">Share to Twitter</li></a><a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://kujohnln.com//2015/06/10/songci/index.html" target="_blank"><li class="mdl-menu__item">Share to Facebook</li></a><a class="post_share-link" href="https://plus.google.com/share?url=https://kujohnln.com//2015/06/10/songci/index.html" target="_blank"><li class="mdl-menu__item">Share to Google+</li></a><a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Kujohn&#39;s blog&title=全宋词之东风何处是人间&summary=Life is like a box of chocolates and you never know what you gonna get.&pics=https://kujohnln.com/favicon.ico&url=https://kujohnln.com/2015/06/10/songci/index.html" target="_blank"><li class="mdl-menu__item">Share to QQ</li></a></ul></div><div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out"><p>&emsp;&emsp;前几天在网上看到一篇文章，说的是一位叫<code>yixuan</code>的网友统计出了宋词词频，并且依据这些统计结果，网友纷纷在下面作词留言，反正聊得挺欢乐的，详情请戳<a href="http://yixuan.cos.name/cn/2011/03/text-mining-of-song-poems/" target="_blank" rel="noopener">这里</a>。顿时呢我也兴趣来了，也想用python(他是用的R语言)自己来实践一下，顺便做几首词出来装装逼。好的，那我们开始了！<br><a id="more"></a></p><h2 id="使用爬虫获取全宋词"><a href="#使用爬虫获取全宋词" class="headerlink" title="使用爬虫获取全宋词"></a>使用爬虫获取全宋词</h2><h3 id="使用工具scrapy"><a href="#使用工具scrapy" class="headerlink" title="使用工具scrapy"></a>使用工具scrapy</h3><p>最近刚好学了<code>scrapy</code>爬虫框架，正好拿来用用。了解更多关于scrapy的知识，可查看<a href="http://doc.scrapy.org/en/latest/intro/tutorial.html" target="_blank" rel="noopener">官方教程</a>；具体使用就不再详细说明了。</p><h3 id="分析网页结构"><a href="#分析网页结构" class="headerlink" title="分析网页结构"></a>分析网页结构</h3><p>好的，废话就不多说了；先找到提供全宋词的网站，<a href="http://www.gushiwen.org/gushi/quansong.aspx" target="_blank" rel="noopener">点击这里</a>。<br>然后在全宋词页面定位诗人，审查元素，如下图所示<img src="/images/upload/songci.png" alt="songci" title="songci"><br>可以发现，链接都有规律，就可以直接放到scrapy的starURL列表里。下面就直接代码感受一下了。</p><h3 id="开始编写代码"><a href="#开始编写代码" class="headerlink" title="开始编写代码"></a>开始编写代码</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># songciSpider.py</span>
<span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span>
__author__ <span class="token operator">=</span> <span class="token string">'echolee'</span>

<span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>selector <span class="token keyword">import</span> Selector

<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spider <span class="token keyword">import</span> Spider
<span class="token keyword">from</span> songci<span class="token punctuation">.</span>items <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">class</span> <span class="token class-name">newsInfoSpider</span><span class="token punctuation">(</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">"songci"</span>
    url_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"gushiwen.org"</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        url_template <span class="token operator">=</span> <span class="token string">'http://www.gushiwen.org/wen_%s.aspx'</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> xrange<span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">3363</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># page:2011-3362</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url_template <span class="token operator">%</span> i<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sel <span class="token operator">=</span> Selector<span class="token punctuation">(</span>response<span class="token punctuation">)</span>

        all_ptag <span class="token operator">=</span> sel<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//div[@class='authorShow']/p"</span><span class="token punctuation">)</span>
        author <span class="token operator">=</span> all_ptag<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        all_pci <span class="token operator">=</span> all_ptag<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'string(.)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        all_ci <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>all_pci<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">,</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">)</span>
        url <span class="token operator">=</span> response<span class="token punctuation">.</span>url
        item <span class="token operator">=</span> SongciItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
        item<span class="token punctuation">[</span><span class="token string">'author'</span><span class="token punctuation">]</span> <span class="token operator">=</span> author
        item<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span> <span class="token operator">=</span> url
        item<span class="token punctuation">[</span><span class="token string">'all_ci'</span><span class="token punctuation">]</span> <span class="token operator">=</span> all_ci

        <span class="token keyword">return</span> item
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># pipelines.py</span>
<span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span>
__author__ <span class="token operator">=</span> <span class="token string">'echolee'</span>
<span class="token keyword">import</span> json
<span class="token keyword">import</span> codecs

<span class="token keyword">class</span> <span class="token class-name">SongciPipeline</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>file <span class="token operator">=</span> codecs<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'songci.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        line <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>
        self<span class="token punctuation">.</span>file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        <span class="token keyword">return</span> item
    <span class="token keyword">def</span> <span class="token function">spider_closed</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里不仅仅提取了诗文，还有作者标题等方便别的用途。</p><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>打开<code>cmd</code> or <code>powershell</code>，进入scrapy project目录，执行命令</p><pre class="line-numbers language-bash"><code class="language-bash">scrapy crawl spiderName <span class="token comment" spellcheck="true"># 这里的spiderName是自己定义的</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后等待抓取完毕保存为json文件即可。</p><h2 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h2><p>&emsp;&emsp;这一节，我们会说到一些简单的文件操作，包括文件读取与写入；还有中文正则匹配，这个中文正则，在我的前一篇文章里有提到过的，<a href="/2015/06/08/Re/">传送门</a>;当然还涉及到json模块解析json数据；下面可以参考我的代码试试。</p><h3 id="读取json文件"><a href="#读取json文件" class="headerlink" title="读取json文件"></a>读取json文件</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 读取json文件，提取所有词文</span>
<span class="token keyword">def</span> <span class="token function">json2str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    file_path <span class="token operator">=</span> <span class="token string">'songci.json'</span>
    fo <span class="token operator">=</span> open<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
    lines <span class="token operator">=</span> fo<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    fo<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    allci_line <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
        jsonline <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>jsonline<span class="token punctuation">)</span>
        ci <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'all_ci'</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># print ci</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="词句初步处理"><a href="#词句初步处理" class="headerlink" title="词句初步处理"></a>词句初步处理</h3><p>去标点并以<code>，。</code>为分割点把词分为一行一句式方便后续处理</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 因为有的词里面有标题以及括号里的副标题</span>
<span class="token comment" spellcheck="true"># 不同的的提取会影响最终结果，所以我这里就三种方式都有(唉，强迫症患者，没办法)</span>
<span class="token comment" spellcheck="true"># 你也可以不用理会，用一个就行了</span>
<span class="token keyword">def</span> <span class="token function">pick2line</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># flag</span>
    <span class="token comment" spellcheck="true"># 0表示全取，1表示只取正词，2表示词+正标题</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        pick <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>u<span class="token string">"[\u4e00-\u9fa5]+"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        pick <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>u<span class="token string">"[\u4e00-\u9fa5]+(?=[\u3002|\uff0c|\u3001]{1})"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        pick <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>u<span class="token string">"[\u4e00-\u9fa5]+"</span><span class="token punctuation">)</span>

        str <span class="token operator">=</span> str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'·'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
        pickbetter <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>u<span class="token string">"[\uff08]{1}[\u4e00-\u9fa5]+[\uff09]{1}"</span><span class="token punctuation">)</span>
        str <span class="token operator">=</span> pickbetter<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span>

    line <span class="token operator">=</span> pick<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>str<span class="token punctuation">)</span>

    <span class="token keyword">return</span> line
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="保存为txt文件"><a href="#保存为txt文件" class="headerlink" title="保存为txt文件"></a>保存为txt文件</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">write2txt</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'songcidata'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">"songcidata"</span><span class="token punctuation">)</span>
    filename <span class="token operator">=</span> <span class="token string">"songcidata/songci_line.txt"</span>
    f <span class="token operator">=</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>lines<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="全部的代码"><a href="#全部的代码" class="headerlink" title="全部的代码"></a>全部的代码</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span>
__author__ <span class="token operator">=</span> <span class="token string">'echolee'</span>

<span class="token keyword">import</span> json<span class="token punctuation">,</span> re<span class="token punctuation">,</span> os<span class="token punctuation">,</span> time


<span class="token keyword">def</span> <span class="token function">pick2line</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># flag</span>
    <span class="token comment" spellcheck="true"># 0表示全取，1表示只取正词，2表示包括正标题</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        pick <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>u<span class="token string">"[\u4e00-\u9fa5]+"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        pick <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>u<span class="token string">"[\u4e00-\u9fa5]+(?=[\u3002|\uff0c|\u3001]{1})"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        pick <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>u<span class="token string">"[\u4e00-\u9fa5]+"</span><span class="token punctuation">)</span>

        str <span class="token operator">=</span> str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'·'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
        pickbetter <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>u<span class="token string">"[\uff08]{1}[\u4e00-\u9fa5]+[\uff09]{1}"</span><span class="token punctuation">)</span>
        str <span class="token operator">=</span> pickbetter<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span>

    line <span class="token operator">=</span> pick<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>str<span class="token punctuation">)</span>

    <span class="token keyword">return</span> line

<span class="token keyword">def</span> <span class="token function">json2str</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
    file_path <span class="token operator">=</span> <span class="token string">'songci.json'</span>
    fo <span class="token operator">=</span> open<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
    lines <span class="token operator">=</span> fo<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    fo<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    allci_line <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
        jsonline <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>jsonline<span class="token punctuation">)</span>
        ci <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'all_ci'</span><span class="token punctuation">]</span>
        <span class="token comment" spellcheck="true"># print ci</span>
        ci_lines <span class="token operator">=</span> pick2line<span class="token punctuation">(</span>ci<span class="token punctuation">,</span> flag<span class="token punctuation">)</span>
        <span class="token keyword">for</span> ci_line <span class="token keyword">in</span> ci_lines<span class="token punctuation">:</span>
            allci_line<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ci_line<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>allci_line<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">write2txt</span><span class="token punctuation">(</span>lines<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'songcidata'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">"songcidata"</span><span class="token punctuation">)</span>
    filename <span class="token operator">=</span> <span class="token string">"songcidata/"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">".txt"</span>
    f <span class="token operator">=</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>lines<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    namelist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'songci_haveall'</span><span class="token punctuation">,</span><span class="token string">'songci_notitle'</span><span class="token punctuation">,</span><span class="token string">'songci_havebettertitle'</span><span class="token punctuation">]</span>
    t0 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> flag <span class="token keyword">in</span> xrange<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        txt <span class="token operator">=</span> json2str<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># print txt</span>
        write2txt<span class="token punctuation">(</span>txt<span class="token punctuation">,</span>namelist<span class="token punctuation">[</span>flag<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token string">'数据处理完成,用时%s s'</span> <span class="token operator">%</span><span class="token punctuation">(</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t0 <span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>好的，经过上面的处理我们已经得到以句为分割的宋词行的txt文本了（我这里只取正文的话，总共有277950句）。</p><h2 id="分词与分析"><a href="#分词与分析" class="headerlink" title="分词与分析"></a>分词与分析</h2><p>&emsp;&emsp;终于，我们要开始正题了么，没错，希望你前面的代码都理解好了；其实很简单有没有;这一节你会发现宋词也挺有趣的；会了解到怎么使用sqlite数据库;还有基于统计的简单分词。</p><h3 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h3><p>&emsp;&emsp;中文分词一直以来都是一个比较有挑战性的问题，我只是做个简单的宋词词频统计而已，所以并不想过多的纠结于分词的问题上；因为宋词的句子一般都比较短，就偷懒直接上暴力的穷举法；简单来讲就是对一个句子进行所有可能的划分，再通过词频高低简单判断并丢弃低频词(词频越高越有可能是一个词，反之则丢弃)。<br>好的，下面就简单的用Python实现一下：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 对每句进行穷举分词</span>
<span class="token keyword">def</span> <span class="token function">fenci</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">:</span>
    line <span class="token operator">=</span> line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> xrange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> xrange<span class="token punctuation">(</span>i<span class="token punctuation">,</span> len<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            key <span class="token operator">=</span> line<span class="token punctuation">[</span>i<span class="token punctuation">:</span>j<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token operator">not</span> key<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> key <span class="token keyword">in</span> fenci_dict<span class="token punctuation">:</span>
                fenci_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                fenci_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token comment" spellcheck="true"># print '>>>'+key</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用sqlite数据库"><a href="#使用sqlite数据库" class="headerlink" title="使用sqlite数据库"></a>使用sqlite数据库</h3><p>为了后面使用方便查询，这里使用sqlite数据库储存分词结果</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sava2db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 使用splite3数据库保存数据方便查询</span>
    conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'songcidata/songci.db'</span><span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 创建table如果不存在</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"create table if not exists songci(key text, value inteager)"</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> index<span class="token punctuation">,</span> key <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>fenci_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> fenci_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 去低频</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">if</span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select * from songci where key=?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'insert into songci values(?,?)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> fenci_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'写入数据库成功...'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="fenci-py全部的代码"><a href="#fenci-py全部的代码" class="headerlink" title="fenci.py全部的代码"></a>fenci.py全部的代码</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span>
__author__ <span class="token operator">=</span> <span class="token string">'echolee'</span>

<span class="token keyword">import</span> sqlite3<span class="token punctuation">,</span> time

<span class="token keyword">def</span> <span class="token function">fenci</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">:</span>
    line <span class="token operator">=</span> line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>u<span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> xrange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> xrange<span class="token punctuation">(</span>i<span class="token punctuation">,</span> len<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            key <span class="token operator">=</span> line<span class="token punctuation">[</span>i<span class="token punctuation">:</span>j<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token operator">not</span> key<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> key <span class="token keyword">in</span> fenci_dict<span class="token punctuation">:</span>
                fenci_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                fenci_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token comment" spellcheck="true">#print '>>>'+key</span>
<span class="token keyword">def</span> <span class="token function">sava2db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 使用splite3数据库保存数据方便查询</span>
    conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'songcidata/songci2.db'</span><span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 创建table如果不存在</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"create table if not exists songci(key text, value inteage)"</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> index<span class="token punctuation">,</span> key <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>fenci_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> fenci_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 去低频，10次以下的词频说明不是词或者意义不大</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">if</span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select * from songci where key=?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'insert into songci values(?,?)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> fenci_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'写入数据库成功...'</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    filename <span class="token operator">=</span> <span class="token string">'songcidata/songci_line.txt'</span>
    fo <span class="token operator">=</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
    lines <span class="token operator">=</span> fo<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    fo<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">global</span> fenci_dict <span class="token comment" spellcheck="true"># 使用全局变量储存结果</span>
    fenci_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
        fenci<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># total = len(fenci_dict)</span>
    <span class="token comment" spellcheck="true"># 排序输出前十</span>
    <span class="token comment" spellcheck="true"># print '总分词结果为',total,'条\n前十条结果为：'</span>
    <span class="token comment" spellcheck="true"># sorted_fenci = sorted(fenci_dict.iteritems(), key = lambda d: d[1], reverse = True)</span>
    <span class="token comment" spellcheck="true"># for i in xrange(10):</span>
        <span class="token comment" spellcheck="true"># print sorted_fenci[i][0],':', sorted_fenci[i][1]</span>
    sava2db<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    t0 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'数据处理完成,用时%.2f s'</span> <span class="token operator">%</span><span class="token punctuation">(</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t0 <span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="输出排序结果"><a href="#输出排序结果" class="headerlink" title="输出排序结果"></a>输出排序结果</h3><p>话也就不多说了，直接进入最激动人心的时刻吧，等一下，还是先看看代码了：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span>
__author__ <span class="token operator">=</span> <span class="token string">'echolee'</span>

<span class="token keyword">import</span> sqlite3

<span class="token keyword">def</span> <span class="token function">getDoubleSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'songcidata/songci.db'</span><span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 查询所有两个字组合的词并排序</span>
    sql <span class="token operator">=</span> <span class="token string">'select * from songci where length(key)=2 order by value desc'</span>
    result <span class="token operator">=</span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    rank <span class="token operator">=</span> <span class="token string">'000000'</span> <span class="token comment" spellcheck="true"># 这里纯属强迫症晚期，只是为了输出时对齐好看</span>
    rank <span class="token operator">=</span> rank<span class="token punctuation">[</span><span class="token punctuation">:</span>len<span class="token punctuation">(</span>str<span class="token punctuation">(</span>len<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># 词频从高到低排序输出</span>
    <span class="token keyword">print</span> <span class="token string">' Rank '</span><span class="token punctuation">,</span><span class="token string">' Word '</span><span class="token punctuation">,</span><span class="token string">' Freq'</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> xrange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> rank<span class="token punctuation">[</span>len<span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">,</span>result<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">':'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    getDoubleSort<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>好的，该来的总是要来的，OK，我们运行看看结果：<br><img src="/images/upload/rank2.png" alt="rank" title="rank"><br>看到这个排名，是不是感到一股亲切感，没错；前三<code>东风</code>、<code>何处</code>、<code>人间</code>，这就是全宋词所隐藏的文字密码，哈哈，全宋词总结起来就是一句话：<code>东风何处是人间</code>（哈哈，装个逼，文科生们请手下留情）。</p><p>再来看看三个字的（查询字长改为3即可）：<br><img src="/images/upload/rank3.png" alt="rank" title="rank"><br>哈哈，3字词频最高的居然是<code>倚阑干</code>，为何这些诗人都爱<code>倚阑干</code>啊，正如马亲王说的：“千古忧愁，不过五个字：独自莫凭栏。”<br>正好在知乎看到过这个问题-<a href="http://www.zhihu.com/question/23858540" target="_blank" rel="noopener">古代诗词大家为何都爱倚栏杆（阑干）?</a>,下面有的回答挺好的。</p><p>对了，有了词频表，也可以自己作作词玩玩了，比如说，数字随机生成词，那就写个简单demo试试：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span>
__author__ <span class="token operator">=</span> <span class="token string">'echolee'</span>

<span class="token keyword">import</span> sqlite3

<span class="token keyword">def</span> <span class="token function">num2songci</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    search <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> xrange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        search<span class="token punctuation">.</span>append<span class="token punctuation">(</span>int<span class="token punctuation">(</span>num<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'songcidata/songci.db'</span><span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> key <span class="token keyword">in</span> search<span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># 每次以第(key-1)条记录为基准取一条记录，</span>
        sql <span class="token operator">=</span> <span class="token string">'select * from songci where length(key)=2 order by value desc limit 1 offset '</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>key<span class="token number">-1</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>比如，来个根号二小数点后几位(<code>4142135623730950488016887242097</code>)<br>再稍微润色一下，即可得如下：</p><pre><code>如梦令·根号二

平生凄凉（感叹凄凉的一生）
回首何事（还能回想什么事呢）
芳草海棠（不就是那些值得回忆的红颜知己）
相思杨柳（还有那些甚是思念的友人）
西湖无情（想起当年西湖断桥的白素贞和许仙，为什么那么无情呢）
如今往事（现在想起以前的种种往事）
一声凄凉（只能再叹一声凄凉）
相思西风（还有那思念仍飘荡在这寒冷的西风中）
</code></pre><p>还挺有趣的吧,那你也可以试一试的；其实的话这里做的比较简陋，比如平仄押韵什么的都没有，如果你有兴趣的话，还可以做得更好，and 欢迎在下面留言！</p></div><div id="disqus-comment"><div id="disqus_thread"></div><style>.ripple-container .ripple{background-color:rgba(255,255,255,.4);animation:ripple 2s forwards cubic-bezier(0,0,.2,1)}@keyframes ripple{0%{transform:scale(0);opacity:1}80%{transform:scale(1)}100%{opacity:0}}.disqus_click_btn{line-height:30px;margin:0;min-width:50px;padding:0 14px;display:inline-block;font-family:Roboto,Helvetica,Arial,sans-serif;font-size:14px;font-weight:400;text-transform:uppercase;letter-spacing:0;overflow:hidden;will-change:box-shadow;transition:box-shadow .2s cubic-bezier(.4,0,1,1),background-color .2s cubic-bezier(.4,0,.2,1),color .2s cubic-bezier(.4,0,.2,1);outline:0;cursor:pointer;text-decoration:none;text-align:center;vertical-align:middle;border:0;background:rgba(158,158,158,.2);box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);color:#fff;background-color:#009688;text-shadow:0}</style><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 DISQUS 可以正常加载）</button></div><script>Array.prototype.forEach.call(document.querySelectorAll("[data-ripple]"),function(e){new RippleEffect(e)})</script><script>var disqus_config=function(){this.page.url="https://kujohnln.com/2015/06/10/songci/",this.page.identifier="https://kujohnln.com/2015/06/10/songci/"};$(".btn_click_load").click(function(){!function(){var t=document,n=t.createElement("script");n.src="//ikuyman-pub.disqus.com/embed.js",n.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(n)}(),$(".btn_click_load").css("display","none")})</script></div><style>#disqus-comment{background-color:#eee;padding:2pc}</style></div><nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col"><a href="/2016/03/22/ajax/" id="post_nav-newer" class="prev-content"><button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation"><i class="material-icons">arrow_back</i></button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Newer</a><div class="section-spacer"></div><a href="/2015/06/08/codecError/" id="post_nav-older" class="next-content">Older &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation"><i class="material-icons">arrow_forward</i></button></a></nav></div></div><div class="sidebar-overlay"></div><aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation"><div id="sidebar-main"><div class="sidebar-header header-cover" style="background-image:url(/img/sidebar_header.png)"><div class="top-bar"></div><button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display:initial" data-upgraded=",MaterialButton,MaterialRipple"><i class="material-icons">clear_all</i> <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button><div class="sidebar-image"><img src="/images/logo.jpg" alt="Kujohn's avatar"></div><a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">Kujohn&#39;s blog <b class="caret"></b></a></div><ul class="nav sidebar-nav"><li class="dropdown"><ul id="settings-dropdown" class="dropdown-menu"><li><a href="mailto:sama2echo@gmail.com" target="_blank" title="Email Me"><i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i> Email Me</a></li></ul></li><li id="sidebar-first-li"><a href="/" target="_self"><i class="material-icons sidebar-material-icons">home</i> Home</a></li><li class="dropdown"><a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown"><i class="material-icons sidebar-material-icons">inbox</i> Archives <b class="caret"></b></a><ul class="dropdown-menu"><li><a class="sidebar_archives-link" href="/archives/2017/12/">December 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">November 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">September 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">July 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">March 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">June 2015<span class="sidebar_archives-count">6</span></a></li></ul></li><li class="dropdown"><a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown"><i class="material-icons sidebar-material-icons">chrome_reader_mode</i> Categories <b class="caret"></b></a><ul class="dropdown-menu"><li><a class="sidebar_archives-link" href="/categories/CSS/">CSS<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/Excel/">Excel<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Hexo/">Hexo<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Javascript/">Javascript<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Linux/">Linux<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/Music/">Music<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Python/">Python<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/Regx/">Regx<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Sass/">Sass<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Tools/">Tools<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/算法/">算法<span class="sidebar_archives-count">3</span></a></li></ul></li><li><a href="/about" title="About"><i class="material-icons sidebar-material-icons">person</i> About</a></li><li class="divider"></li><li><a href="/archives">Articles <span class="sidebar-badge">23</span></a></li></ul></div></aside><div id="back-to-top" class="toTop-wrap"><a href="#top" class="toTop"><i class="material-icons footer_top-i">expand_less</i></a></div><footer class="mdl-mini-footer" id="bottom"><div class="mdl-mini-footer--left-section sns-list"><a href="https://twitter.com/KujohnLn" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image:url(/img/footer/footer_ico-twitter.svg)"><span class="visuallyhidden">Twitter</span></button></a><a href="https://weibo.com/kuJohn" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image:url(/img/footer/footer_ico-weibo.svg)"><span class="visuallyhidden">Weibo</span></button></a><a href="https://github.com/i2Echo" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image:url(/img/footer/footer_ico-github.svg)"><span class="visuallyhidden">Github</span></button></a></div><div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd=new Date;document.write(fd.getFullYear())</script>&nbsp;Kujohn's blog</div><div class="mdl-mini-footer--right-section"><div><div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div><div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div></div></div></footer><script src="/js/lazyload.min.js"></script><script src="/js/js.js"></script><script src="/js/canvas-nest.min.js"></script><script src="/js/nprogress.js"></script><script type="text/javascript">NProgress.configure({showSpinner:!0}),NProgress.start(),$("#nprogress .bar").css({background:"#29d"}),$("#nprogress .peg").css({"box-shadow":"0 0 10px #29d, 0 0 15px #29d"}),$("#nprogress .spinner-icon").css({"border-top-color":"#29d","border-left-color":"#29d"}),setTimeout(function(){NProgress.done(),$(".fade").removeClass("out")},800)</script><script>$(window).load(function(){$(".post-toc-wrap").parent(".mdl-menu__container").css("position","fixed")})</script><script>queue.offer(function(){$(".lazy").lazyload({effect:"show"})}),$(document).ready(function(){setTimeout(function(){setInterval(function(){queue.execNext()},200)},3e3)})</script></main></div></body></html>